import * as mapColors from 'stores/@/MapColors';
import { Context } from "context";

/******************************/

export default function bindMainCanvasGlobalStore(
    context: Context
) {
    const globalStore = context.stores.global;
    const storeHelper = context.stores.helper;
    const mainCanvas = context.mainCanvas;

    // set colors to canvas on change

    let previosMapColors = globalStore.getState().mapColors;

    let unsubscriberStore = globalStore.subscribe(() => {
        let currentMapColors = globalStore.getState().mapColors;

        if (currentMapColors !== previosMapColors) {
            let mergedState = storeHelper.getMapColors();

            // update colors map
            for (let key in mapColors.maps.key2color) {
                let color = mergedState[ key ];

                mainCanvas.commands.setColorInSlot(
                    mapColors.maps.key2color[ key ].index,
                    color
                );
            }

            previosMapColors = currentMapColors;
        }
    });
}