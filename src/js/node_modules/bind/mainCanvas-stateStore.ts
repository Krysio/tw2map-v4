import * as mapColors from 'stores/@/MapColors';
import { Context } from "context";

/******************************/

export default function bindMainCanvasStateStore(
    context: Context
) {
    const stateStore = context.stores.state;

    // set colors to canvas on change

    let { marketKey, worldKey } = stateStore.getState().location,
        previosLocation = `${ marketKey }/${ worldKey }`;

    let unsubscriberStore = stateStore.subscribe(() => {
        let { marketKey, worldKey } = stateStore.getState().location,
            currentLocation = `${ marketKey }/${ worldKey }`;

        if (currentLocation !== previosLocation) {
            // TODO stop previous loading

            (async function(){
                await context.mainCanvas.initPromise;

                // async
                (async function(){
                    let bacgroundBitData = await (
                        await fetch('/data/mapv2-rc1.bin')
                    ).arrayBuffer();
                    context.data.commands.loadBackgroundData(bacgroundBitData);
                })();
                (async function(){
                    let jsonData = await (
                        await fetch('/data/data.json')
                    ).json();
                    context.data.commands.loadBaseBata(jsonData);
                })();
            })();
        }
    });
}