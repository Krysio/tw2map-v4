import * as React from 'react';
import { Modal, Header, Body, Footer, Hook } from "libs/ModalManager";
import LazyPromise from 'libs/LazyPromise';

import { Tab, Tabs, TabList, TabPanel } from 'react-tabs';

import { ViewContext } from 'view/viewContext';
import Top20Tribes from 'view/components/Top20Tribes';
import Top20Characters from 'view/components/Top20Characters';
import WorldDetails from 'view/components/WorldDetails';
import { IconTop, IconWorld } from 'view/components/icon';

/******************************/

export default function featureMapDetails(
    context: ViewContext
): (tab?: string) => Promise<string> {
    let hook: Hook = context.modalSystem.createHook(),
        lazyPromise = new LazyPromise();

    hook.setLayout(
        <Modal
            hidden={ true }
            hideNotUnmount={ true }
        >
            <Header>
                World details
            </Header>
            <Body
                className="p-2"
                style={{ minWidth: '40em' }}
            >
                <Tabs
                    onSelect={ hook.update }
                >
                    <TabList>
                        <Tab>
                            <IconWorld /> World details
                        </Tab>
                        <Tab>
                            <IconTop /> Top 25 tribes
                        </Tab>
                        <Tab>
                            <IconTop /> Top 25 players
                        </Tab>
                    </TabList>

                    <TabPanel>
                        <WorldDetails context={ context } />
                    </TabPanel>

                    <TabPanel>
                        <Top20Tribes context={ context } />
                    </TabPanel>

                    <TabPanel>
                        <Top20Characters context={ context } />
                    </TabPanel>
                </Tabs>
            </Body>
        </Modal>
    );

    function open(
        tab?: string
    ): Promise<string> {
        if (hook.isHidden()) {
            hook.show();
            hook.setCursorPosition();
        }

        return lazyPromise.get();
    }

    return open;
}