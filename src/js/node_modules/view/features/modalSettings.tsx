import * as React from 'react';
import { Modal, Header, Body, Footer, Hook } from "libs/ModalManager";
import LazyPromise from 'libs/LazyPromise';

import { Tab, Tabs, TabList, TabPanel } from 'react-tabs';
import MapColors from 'view/components/settings/MapColors';

import { ViewContext } from 'view/viewContext';
import PrivacySettings from 'view/components/settings/PrivacySettings';

/******************************/

export default function featureSettings(
    refContext: any
): (tab?: string) => Promise<string> {
    const context: ViewContext = refContext;
    let hook: Hook = context.modalSystem.createHook(),
        lazyPromise = new LazyPromise();

    hook.setLayout(
        <Modal
            hidden={ true }
            hideNotUnmount={ true }
        >
            <Header>
                Settings
            </Header>
            <Body
                className="p-2"
                style={{ minWidth: '20em' }}
            >
                <Tabs
                    onSelect={ hook.update }
                >
                    <TabList>
                        <Tab>Global</Tab>
                        <Tab>World</Tab>
                    </TabList>

                    <TabPanel>
                        <Tabs
                            onSelect={ hook.update }
                        >
                            <TabList>
                                <Tab>Map colors</Tab>
                                <Tab>Privacy settings</Tab>
                            </TabList>

                            <TabPanel>
                                <MapColors
                                    context={ context }
                                    store={ context.stores.global }
                                />
                            </TabPanel>
                            <TabPanel>
                                <PrivacySettings context={ context } />
                            </TabPanel>
                        </Tabs>
                    </TabPanel>

                    <TabPanel>
                        <Tabs
                            onSelect={ hook.update }
                        >
                            <TabList>
                                <Tab>Map colors</Tab>
                            </TabList>

                            <TabPanel>
                                <MapColors
                                    allowDisable={ true }
                                    context={ context }
                                    store={ context.stores.world }
                                />
                            </TabPanel>
                        </Tabs>
                    </TabPanel>
                </Tabs>
            </Body>
        </Modal>
    );

    function open(
        tab?: string
    ): Promise<string> {
        if (hook.isHidden()) {
            hook.show();
            hook.setCursorPosition();
        }

        return lazyPromise.get();
    }

    window['mSettings'] = hook;

    return open;
}