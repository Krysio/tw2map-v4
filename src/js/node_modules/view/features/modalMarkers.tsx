import * as React from 'react';
import { Modal, Header, Body, Footer, Hook } from "libs/ModalManager";
import { ViewContext } from 'view/viewContext';
import LazyPromise from 'libs/LazyPromise';
import MarkersModalBody from 'view/components/markers/ModalBody';
import MarkersModalFooter from 'view/components/markers/ModalFooter';

/******************************/

export default function featureMarkers(
    context: ViewContext
): () => Promise<string> {
    let hook: Hook = context.modalSystem.createHook(),
        lazyPromise = new LazyPromise<string>();

    hook.setLayout(
        <Modal
            hidden={ true }
            hideNotUnmount={ true }
            className="markersModal"
        >
            <Header>
                Markers
            </Header>
            <Body className="p-2">
                <MarkersModalBody
                    hook={ hook }
                    context={ context }
                    updateModal={ hook.update }
                />
            </Body>
            <Footer>
                <MarkersModalFooter
                    hook={ hook }
                    context={ context }
                    updateModal={ hook.update }
                />
            </Footer>
        </Modal>
    );

    function open(): Promise<string> {
        if (hook.isHidden()) {
            hook.show();
            hook.setCursorPosition();
        }

        return lazyPromise.get();
    }

    window['mMarkers'] = hook;

    return open;
}