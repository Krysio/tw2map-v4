import * as React from 'react';
import ModalManager from "libs/ModalManager/ModalManager";
import { Modal, Header, Body, Footer, Hook } from "libs/ModalManager";
import LazyPromise from 'libs/LazyPromise';

const ColorPicker = require('rc-color-picker');

/******************************/

export default function colorPickerService(
    modalManager: ModalManager
): (inputColor: string) => Promise<string> {
    function service(
        inputColor: string
    ): Promise<string> {
        let hook: Hook = modalManager.createHook(),
            color: string = inputColor,
            lazyPromise = new LazyPromise();

        hook.setLayout(
            <Modal>
                <Header>
                    Color picker
                </Header>
                <Body className="p-0">
                    <ColorPicker.Panel
                        color={ color }
                        enableAlpha={ false }
                        onChange={(colorBox: {color: string, alpha: number}) => {
                            color = colorBox.color;
                        }}
                    />
                </Body>
                <Footer>
                    <button
                        className="btn btn-success"
                        onClick={(e) => {
                            hook.close();
                            lazyPromise.resolve(color);
                        }}
                    >
                        OK
                    </button>
                    <button
                        className="btn btn-warrning"
                        onClick={(e) => {
                            hook.close();
                            lazyPromise.reject(null);
                        }}
                    >
                        Cancel
                    </button>
                </Footer>
            </Modal>
        );

        return lazyPromise.get();
    }

    return service;
}