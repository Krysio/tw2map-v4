import Events from "core/Events";
import MapData from "core/data/MapData";
import Item from "core/data/objects/Item";

/******************************/

export default function featureSearch(
    events: Events,
    mapData: MapData
): void {
    events.on('search/phase', (phase: string) => {
        let results: Item[] = [],
            temp: number;

        // tribes
        temp = 0;
        for (let id in mapData.tribeMap) {
            let item = mapData.tribeMap[ id ];

            if (item.name.toLowerCase().indexOf(phase) !== -1
                || item.tag.toLowerCase().indexOf(phase) !== -1
            ) {
                results.push(item);

                temp++;
                if (temp > 10) {
                    break;
                }
            }
        }

        // characters
        temp = 0;
        for (let id in mapData.characterMap) {
            let item = mapData.characterMap[ id ];

            if (item.name.toLowerCase().indexOf(phase) !== -1) {
                results.push(item);

                temp++;
                if (temp > 10) {
                    break;
                }
            }
        }

        // villages
        temp = 0;
        for (let id in mapData.villageMap) {
            let item = mapData.villageMap[ id ];

            if (item.name.toLowerCase().indexOf(phase) !== -1) {
                results.push(item);

                temp++;
                if (temp > 10) {
                    break;
                }
            }
        }

        events.emit('search/result', results);
    });
}