import {
    State, INIT_STATE,
    IMPORT_DB
} from './types';

/******************************/

export function reducer(
    state = INIT_STATE,
    action
): State {
    switch (action.type) {
        case IMPORT_DB:
            let data = {};

            for (let i = 0; i < action.value.length; i++) {
                let { key, value } = action.value[ i ];

                if (key in INIT_STATE) {
                    data[ key ] = value;
                }
            }

            return {...state, ...data};
    }

    // defualt

    let newState = { ...state },
        path = action.type.split('/'),
        ref = newState,
        property = path.shift();

    while (path.length) {

        if (Object.hasOwnProperty.call(ref, property)) {
            ref = ref[ property ];
            property = path.shift();
            continue;
        }

        return state;
    }

    ref[ property ] = action.value;

    return newState;
}