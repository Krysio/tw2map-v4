import Events from "data/Events";
import MapData from "data/data/MapData";

/******************************/

export default function commandLoadRankingData(
    events: Events,
    mapData: MapData
) {
    return {
        loadRankingBata(jsonData: any): void {
            // odczytywanie rankingu graczy
            for (let characterId in jsonData.characterRanking) {
                let character = mapData.getCharacter(characterId);

                if (character !== null) {
                    let [ rank, off, def ] = jsonData.characterRanking[ characterId ];

                    character.rank = rank;
                    character.pointsOff = off;
                    character.pointsDef = def;
                    character.pointsTotal = Math.max(0, off - def);
                }
            }

            // odczytywanie rankingu plemion
            for (let tribeId in jsonData.tribeRanking) {
                let tribe = mapData.getTribe(tribeId);

                if (tribe !== null) {
                    let [ rank, off, def, victoryPoints, power ] = jsonData.tribeRanking[ tribeId ];

                    tribe.rank = rank;
                    tribe.victoryPoints = victoryPoints;
                    tribe.power = power;
                    tribe.pointsOff = off;
                    tribe.pointsDef = def;
                    tribe.pointsTotal = Math.max(0, off - def);
                }
            }

            events.emit('changed data/base', null);
        }
    };
}