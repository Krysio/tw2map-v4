import Events from "data/Events";
import MapData from "data/data/MapData";
import Character from "data/data/Character";
import Village from "data/data/Village";
import Tribe from "data/data/Tribe";

import {
    MAP_SIZE, TILE_TYPE_VILLAGE
} from "appConstants";

/******************************/

export default function commandLoadBaseData(
    events: Events,
    mapData: MapData
) {
    return {
        loadBaseBata(jsonData: any): void {
            mapData.setDownloadTime(jsonData.time);

            // odczytywanie plemion i tworzenie obiektów
            for (let tribeId in jsonData.tribes) {
                let tribeData = jsonData.tribes[ tribeId ],
                    tribe: Tribe = new Tribe();

                tribe.id = parseInt(tribeId);
                tribe.name = tribeData[0];
                tribe.tag = tribeData[1];
                tribe.points = parseInt(tribeData[2]);

                mapData.addTribe(tribe);
            }

            // odczytywanie graczy i tworzenie obiektów
            for (let characterId in jsonData.characters) {
                let characterData = jsonData.characters[ characterId ],
                    character = new Character();

                character.id = parseInt(characterId);
                character.name = characterData[0];
                character.points = parseInt(characterData[1]);
                character.tribeId = parseInt(characterData[2]) || null;

                mapData.addCharacter(character);
            }

            // odczytywanie wiosek i tworzenie obiektów
            for (let villageId in jsonData.villages) {
                let villageData = jsonData.villages[ villageId ],
                    village = new Village();

                village.id = parseInt(villageId);
                village.x = parseInt(villageData[0]);
                village.y = parseInt(villageData[1]);
                village.name = villageData[2];
                village.points = parseInt(villageData[3]);
                village.characterId = parseInt(villageData[4]) || null;

                mapData.addVillage(village);

                mapData.tileSetType(
                    village.y * MAP_SIZE + village.x,
                    TILE_TYPE_VILLAGE
                );
            }

            events.emit('changed data/base', null);
        }
    };
}